<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>1Downloader</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container text-center mt-5">
    <h1 class="mb-4">1Downloader - YouTube Downloader</h1>

    <div id="form-section">
        <div class="input-group mb-3">
            <input type="url" id="urlInput" class="form-control" placeholder="Enter YouTube URL" required>
            <button id="fetchInfoBtn" class="btn btn-primary">Fetch Info</button>
        </div>

        <div id="infoSection" style="display: none;">
            <img id="thumbnail" class="img-fluid rounded mb-3" style="max-width: 300px;">
            <h5 id="title"></h5>

            <div class="input-group mb-3">
                <select id="formatSelect" class="form-select">
                    <option value="mp4">MP4 (Video)</option>
                    <option value="mp3">MP3 (Audio)</option>
                </select>
                <button id="downloadBtn" class="btn btn-success">Download</button>
            </div>
        </div>

        <div class="progress" style="height: 20px; display: none;" id="progressBarContainer">
            <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                 role="progressbar" style="width: 0%;">0%</div>
        </div>

        <div id="statusMessage" class="mt-3"></div>
    </div>
</div>

<script>
document.getElementById('fetchInfoBtn').onclick = function() {
    const url = document.getElementById('urlInput').value;
    fetch('/get_info', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            document.getElementById('statusMessage').innerHTML = '<div class="alert alert-danger">' + data.error + '</div>';
        } else {
            document.getElementById('thumbnail').src = data.thumbnail;
            document.getElementById('title').innerText = data.title;
            document.getElementById('infoSection').style.display = 'block';
            document.getElementById('statusMessage').innerHTML = '';
        }
    });
};

document.getElementById('downloadBtn').onclick = function() {
    const url = document.getElementById('urlInput').value;
    const format = document.getElementById('formatSelect').value;
    document.getElementById('progressBarContainer').style.display = 'block';
    document.getElementById('progressBar').style.width = '0%';
    document.getElementById('progressBar').innerText = '0%';

    const eventSource = new EventSource(`/download_progress?url=${encodeURIComponent(url)}&format=${format}`);
    eventSource.onmessage = function(e) {
        const data = JSON.parse(e.data);
        if (data.progress) {
            document.getElementById('progressBar').style.width = data.progress + '%';
            document.getElementById('progressBar').innerText = data.progress + '%';
        }
        if (data.status === 'done') {
            eventSource.close();
            window.location.href = `/download_file?filename=${data.filename}`;
        }
        if (data.status === 'error') {
            eventSource.close();
            document.getElementById('statusMessage').innerHTML = '<div class="alert alert-danger">' + data.message + '</div>';
        }
    };
};
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
